<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stats - J2025Scorecard | Marks vs Percentile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #1a202c;
            color: white;
            font-family: 'Poppins', sans-serif;
        }
        .container-custom {
            background: #1F2937;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        table {
            width: 100%;
        }
        th, td {
            padding: 10px;
            border: 1px solid #374151;
            text-align: left;
        }
        th {
            background: #374151;
        }
        tr:hover {
            background: #2D3748;
        }
        .toggle-btn {
            cursor: pointer;
        }
        footer {
            text-align: center;
            margin-top: 20px;
        }
        .disclaimer {
            font-size: 0.85rem;
            font-style: italic;
            color: #9ca3af;
            margin-top: 10px;
        }
        .highlight {
            color: #fbbf24;
            font-weight: 600;
        }
        .reddit-link {
            color: #3b82f6;
            text-decoration: none;
        }
        .reddit-link:hover {
            text-decoration: underline;
            color: #60a5fa;
        }
        .analysis-container {
            background: #2D3748;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .analysis-title {
            color: #0bb3f5;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .shift-item {
            margin-bottom: 15px;
        }
        .shift-title {
            font-weight: 600;
            color: #d1d5db;
        }
        .impact-factor {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-left: 20px;
        }
    </style>
</head>
<body class="p-4">

    <h1 class="text-center mb-4"><strong>Stats - J2025Scorecard</strong></h1>

    <p class="text-center mb-4">Last Updated: <span id="lastUpdated">Loading...</span></p>

    <div class="container-custom text-center p-3">
        <p class="fs-5 fw-bold mb-0">Total Scores Recorded: <span id="totalScores" class="text-info">Loading...</span></p>
    </div>

    <div class="container-custom">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="fs-4">Estimated Marks vs Percentile</h2>
            <!--<div>
                <i class="fas fa-table toggle-btn btn btn-sm btn-secondary" onclick="toggleView('percentileTableContainer', 'percentileChartContainer')"></i>
                <i class="fas fa-chart-bar toggle-btn btn btn-sm btn-secondary" onclick="toggleView('percentileChartContainer', 'percentileTableContainer')"></i>
            </div>-->
        </div>

        <div id="percentileTableContainer">
            <div class="table-responsive">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th style="position: sticky; left: -1px; z-index: 1;">Percentile</th>
                            <th>April 2s1</th>
                            <th>April 2s2</th>
                            <th>April 3s1</th>
                            <th>April 3s2</th>
                            <th>April 4s1</th>
                            <th>April 4s2</th>
                            <th>April 7s1</th>
                            <th>April 7s2</th>
                            <th>April 8s2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99</td>
                            <td style="color: cyan;">176</td>
                            <td style="color: rgb(250, 226, 70);">205</td>
                            <td style="color: rgb(0, 255, 0);">165</td>
                            <td style="color: cyan;">194</td>
                            <td style="color: cyan;">178</td>
                            <td style="color: cyan;">180</td>
                            <td style="color: cyan;">175</td>
                            <td style="color: cyan;">184</td>
                            <td style="color: cyan;">182</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">98.5</td>
                            <td>165</td>
                            <td>192</td>
                            <td>155</td>
                            <td>182</td>
                            <td>167</td>
                            <td>169</td>
                            <td>164</td>
                            <td>172</td>
                            <td>170</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">98</td>
                            <td>155</td>
                            <td>182</td>
                            <td>146</td>
                            <td>172</td>
                            <td>157</td>
                            <td>159</td>
                            <td>154</td>
                            <td>162</td>
                            <td>160</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">97.5</td>
                            <td>147</td>
                            <td>173</td>
                            <td>138</td>
                            <td>163</td>
                            <td>149</td>
                            <td>151</td>
                            <td>146</td>
                            <td>154</td>
                            <td>152</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">97</td>
                            <td>140</td>
                            <td>165</td>
                            <td>132</td>
                            <td>155</td>
                            <td>142</td>
                            <td>144</td>
                            <td>139</td>
                            <td>147</td>
                            <td>145</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">96.5</td>
                            <td>134</td>
                            <td>158</td>
                            <td>127</td>
                            <td>149</td>
                            <td>136</td>
                            <td>138</td>
                            <td>133</td>
                            <td>141</td>
                            <td>139</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">96</td>
                            <td>129</td>
                            <td>152</td>
                            <td>122</td>
                            <td>143</td>
                            <td>131</td>
                            <td>133</td>
                            <td>128</td>
                            <td>136</td>
                            <td>134</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">95.5</td>
                            <td>124</td>
                            <td>147</td>
                            <td>118</td>
                            <td>138</td>
                            <td>126</td>
                            <td>128</td>
                            <td>123</td>
                            <td>131</td>
                            <td>130</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">95</td>
                            <td>120</td>
                            <td>142</td>
                            <td>114</td>
                            <td>134</td>
                            <td>122</td>
                            <td>124</td>
                            <td>119</td>
                            <td>127</td>
                            <td>125</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">94</td>
                            <td>113</td>
                            <td>134</td>
                            <td>107</td>
                            <td>126</td>
                            <td>115</td>
                            <td>117</td>
                            <td>112</td>
                            <td>120</td>
                            <td>118</td>
                        </tr>
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">93</td>
                            <td>107</td>
                            <td>127</td>
                            <td>101</td>
                            <td>119</td>
                            <td>109</td>
                            <td>110</td>
                            <td>106</td>
                            <td>114</td>
                            <td>112</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="disclaimer">Disclaimer: These are predictions based on available dataset to J2025Scorecard Marks Calculator. Actual NTA percentiles will differ.</p>
        </div>
        <div class="table-responsive mt-4">
            <table class="table table-dark table-striped">
                <thead>
                    <tr>
                        <th style="position: sticky; left: -1px; z-index: 1;">Percentile</th>
                        <th>April 2s1</th>
                        <th>April 2s2</th>
                        <th>April 3s1</th>
                        <th>April 3s2</th>
                        <th>April 4s1</th>
                        <th>April 4s2</th>
                        <th>April 7s1</th>
                        <th>April 7s2</th>
                        <th>April 8s2</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.9</td>
                        <td>236</td>
                        <td>271</td>
                        <td>220</td>
                        <td>258</td>
                        <td>239</td>
                        <td>241</td>
                        <td>234</td>
                        <td>247</td>
                        <td>244</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.8</td>
                        <td>220</td>
                        <td>255</td>
                        <td>206</td>
                        <td>242</td>
                        <td>223</td>
                        <td>225</td>
                        <td>218</td>
                        <td>231</td>
                        <td>228</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.7</td>
                        <td>210</td>
                        <td>244</td>
                        <td>196</td>
                        <td>231</td>
                        <td>213</td>
                        <td>215</td>
                        <td>208</td>
                        <td>221</td>
                        <td>218</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.6</td>
                        <td>202</td>
                        <td>235</td>
                        <td>189</td>
                        <td>222</td>
                        <td>205</td>
                        <td>207</td>
                        <td>200</td>
                        <td>212</td>
                        <td>210</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.5</td>
                        <td>196</td>
                        <td>228</td>
                        <td>183</td>
                        <td>215</td>
                        <td>199</td>
                        <td>201</td>
                        <td>194</td>
                        <td>206</td>
                        <td>203</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.4</td>
                        <td>190</td>
                        <td>222</td>
                        <td>178</td>
                        <td>209</td>
                        <td>193</td>
                        <td>195</td>
                        <td>188</td>
                        <td>200</td>
                        <td>197</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.3</td>
                        <td>186</td>
                        <td>217</td>
                        <td>174</td>
                        <td>204</td>
                        <td>189</td>
                        <td>191</td>
                        <td>184</td>
                        <td>195</td>
                        <td>193</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.2</td>
                        <td>182</td>
                        <td>213</td>
                        <td>170</td>
                        <td>200</td>
                        <td>185</td>
                        <td>187</td>
                        <td>180</td>
                        <td>191</td>
                        <td>189</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.1</td>
                        <td>179</td>
                        <td>209</td>
                        <td>167</td>
                        <td>197</td>
                        <td>182</td>
                        <td>184</td>
                        <td>177</td>
                        <td>187</td>
                        <td>185</td>
                    </tr>
                    <tr>
                        <td style="position: sticky; left: -1px; z-index: 1; color: cyan;">99.0</td>
                        <td>176</td>
                        <td>205</td>
                        <td>165</td>
                        <td>194</td>
                        <td>178</td>
                        <td>180</td>
                        <td>175</td>
                        <td>184</td>
                        <td>182</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="percentileChartContainer" class="d-none">
            <canvas id="percentileChart"></canvas>
            <p class="disclaimer">Disclaimer: These are predictions based on available dataset to J2025Scorecard Marks Calculator. Actual NTA percentiles may differ.</p>
        </div>

        <!-- Analysis Section -->
        <div class="analysis-container">
            <h3 class="analysis-title">April 2025 Session Shifts (Hardest to Easiest)</h3>
            
            <div class="shift-item">
                <p class="shift-title">1. April 3, Shift 1 (Hardest)</p>
                <p class="impact-factor">• Lowest 99th percentile score: 165</p>
                <p class="impact-factor">• Impact factors: Only 39 scorers above 200 out of 2255 records (1.7%)</p>
                <p class="impact-factor">• Key insight: Despite median of 76, the lack of high scorers significantly impacts percentile boundaries</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">2. April 7, Shift 1</p>
                <p class="impact-factor">• 99th percentile score: 175</p>
                <p class="impact-factor">• Impact factors: Only 69 scorers above 200 out of 2226 records (3.1%)</p>
                <p class="impact-factor">• Profile: Second lowest number of 250+ scorers (only 5)</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">3. April 2, Shift 1</p>
                <p class="impact-factor">• 99th percentile score: 176</p>
                <p class="impact-factor">• Impact factors: Despite lowest median (66), has relatively better high-end performance</p>
                <p class="impact-factor">• Key insight: 73 scorers above 200 out of 2281 records (3.2%), including 14 above 250</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">4. April 4, Shift 1</p>
                <p class="impact-factor">• 99th percentile score: 178</p>
                <p class="impact-factor">• Impact factors: 79 scorers above 200 out of 2228 records (3.5%)</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">5. April 4, Shift 2</p>
                <p class="impact-factor">• 99th percentile score: 180</p>
                <p class="impact-factor">• Impact factors: 102 scorers above 200 out of 2354 records (4.3%)</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">6. April 8, Shift 2</p>
                <p class="impact-factor">• 99th percentile score: 182</p>
                <p class="impact-factor">• Impact factors: 92 scorers above 200 out of 2121 records (4.3%), better ratio than April 4 Shift 2</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">7. April 7, Shift 2</p>
                <p class="impact-factor">• 99th percentile score: 184</p>
                <p class="impact-factor">• Impact factors: 111 scorers above 200 out of 2319 records (4.8%)</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">8. April 3, Shift 2</p>
                <p class="impact-factor">• 99th percentile score: 194</p>
                <p class="impact-factor">• Impact factors: 172 scorers above 200 out of 2340 records (7.4%)</p>
                <p class="impact-factor">• High median (89) combined with significant number of top scorers</p>
            </div>
            
            <div class="shift-item">
                <p class="shift-title">9. April 2, Shift 2 (Easiest)</p>
                <p class="impact-factor">• 99th percentile score: 205</p>
                <p class="impact-factor">• Impact factors: 186 scorers above 200 out of 2344 records (7.9%)</p>
                <p class="impact-factor">• Highest median (96.5) and highest number of top scorers (37 above 250)</p>
            </div>
        </div>
    </div>

    <div class="container-custom">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="fs-4">Median & Avg Scores</h2>
            <div>
                <i class="fas fa-table toggle-btn btn btn-sm btn-secondary" onclick="toggleView('medianAvgTableContainer', 'medianAvgChartContainer')"></i>
                <i class="fas fa-chart-bar toggle-btn btn btn-sm btn-secondary" onclick="toggleView('medianAvgChartContainer', 'medianAvgTableContainer')"></i>
            </div>
        </div>

        <div id="medianAvgTableContainer">
            <div class="table-responsive">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Exam Date</th>
                            <th>Scores Recorded</th>
                            <th>Median</th>
                            <th>Avg</th>
                        </tr>
                    </thead>
                    <tbody id="medianAvgTable"></tbody>
                </table>
            </div>
        </div>
        <div id="medianAvgChartContainer" class="d-none">
            <canvas id="medianAvgChart"></canvas>
        </div>
        <div class="mt-2">
            <small class="text-white">
                <strong>Note:</strong> The median score is calculated based on the unique scores recorded.
            </small>
        </div>
    </div>

    <div class="container-custom">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="fs-4">Above Score Ranges</h2>
            <div id="aboveScoreChartControls" class="d-none">
                <select id="aboveScoreSelect1">
                    <option value="above140">Above 140</option>
                    <option value="above180">Above 180</option>
                    <option value="above200">Above 200</option>
                    <option value="above230">Above 230</option>
                    <option value="above250">Above 250</option>
                </select>
                <select id="aboveScoreSelect2">
                    <option value="above180">Above 180</option>
                    <option value="above140">Above 140</option>
                    <option value="above200">Above 200</option>
                    <option value="above230">Above 230</option>
                    <option value="above250">Above 250</option>
                </select>
            </div>
            <div>
                <i class="fas fa-table toggle-btn btn btn-sm btn-secondary" onclick="toggleView('aboveScoreTableContainer', 'aboveScoreChartContainer')"></i>
                <i class="fas fa-chart-bar toggle-btn btn btn-sm btn-secondary" onclick="toggleView('aboveScoreChartContainer', 'aboveScoreTableContainer')"></i>
            </div>
        </div>

        <div id="aboveScoreTableContainer">
            <div class="table-responsive">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th style="position: sticky; left: -1px; z-index: 1;">Exam Date</th>
                            <th>Scores Recorded</th>
                            <th>Above 140</th>
                            <th>Above 180</th>
                            <th>Above 200</th>
                            <th>Above 230</th>
                            <th>Above 250</th>
                        </tr>
                    </thead>
                    <tbody id="aboveScoreTable"></tbody>
                </table>
            </div>
        </div>
        <div id="aboveScoreChartContainer" class="d-none">
            <canvas id="aboveScoreChart"></canvas>
        </div>
    </div>

    <div class="container-custom">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="fs-4">Specific Score Ranges</h2>
            <div id="specificRangeChartControls" class="d-none">
                <select id="specificRangeSelect1">
                    <option value="range_140_160">140-160</option>
                    <option value="range_180_200">180-200</option>
                    <option value="range_200_230">200-230</option>
                    <option value="range_250_above">250+</option>
                </select>
                <select id="specificRangeSelect2">
                    <option value="range_180_200">180-200</option>
                    <option value="range_140_160">140-160</option>
                    <option value="range_200_230">200-230</option>
                    <option value="range_250_above">250+</option>
                </select>
            </div>
            <div>
                <i class="fas fa-table toggle-btn btn btn-sm btn-secondary" onclick="toggleView('specificRangeTableContainer', 'specificRangeChartContainer')"></i>
                <i class="fas fa-chart-bar toggle-btn btn btn-sm btn-secondary" onclick="toggleView('specificRangeChartContainer', 'specificRangeTableContainer')"></i>
            </div>
        </div>

        <div id="specificRangeTableContainer">
            <div class="table-responsive">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th style="position: sticky; left: -1px; z-index: 1;">Exam Date</th>
                            <th>Scores Recorded</th>
                            <th>140-160</th>
                            <th>180-200</th>
                            <th>200-230</th>
                            <th>250+</th>
                        </tr>
                    </thead>
                    <tbody id="specificRangeTable"></tbody>
                </table>
            </div>
        </div>
        <div id="specificRangeChartContainer" class="d-none">
            <canvas id="specificRangeChart"></canvas>
        </div>
    </div>

    <footer>
        TOTAL ACTIVE USERS - <span id="totalUsers" class="text-info">Loading...</span> <span style="font-size: small;">(Last 90 days)</span> <br>
        By - <span class="text-primary">u/Novadrone16</span>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function fetchData() {
            const Url = "https://stats-api.iitjeepritam.workers.dev/stats";
            const proxyUrl = `https://cors-proxy.novadrone16.workers.dev?url=${encodeURIComponent(Url)}`;
    
            try {
                const response = await fetch(proxyUrl);
                //const response = await fetch("/.netlify/functions/fetchStats");

                const stats = await response.json();
    
                const apiTime = stats.lastUpdated;
    
                const year = apiTime.substring(0, 4);
                const month = apiTime.substring(5, 7);
                const day = apiTime.substring(8, 10);
                const hour = apiTime.substring(11, 13);
                const minute = apiTime.substring(14, 16);
                const hour12 = (parseInt(hour) % 12) || 12;
                const ampm = parseInt(hour) >= 12 ? 'PM' : 'AM';
    
                const formattedDate = `${day}/${month}/${year} - ${hour12.toString().padStart(2, '0')}:${minute.padStart(2, '0')} ${ampm}`;
    
                document.getElementById("lastUpdated").textContent = formattedDate;
                document.getElementById("totalScores").textContent = stats.totalCountAllDates;
                //document.getElementById("activeUsers").textContent = stats.analytics.realTime.activeUsersLast30Min || "0";
                document.getElementById("totalUsers").textContent = stats.analytics.last90Days.totalUsers;
    
                const examStats = stats.examStats;
    
                const examDates = Object.keys(examStats).map(exam => {
                    const parts = exam.split('-');
                    const dateStr = `${parts[0]}-${parts[1]}-${parts[2]}`;
                    const date = new Date(dateStr);
                    const shift = parts.length > 4 ? parseInt(parts[4]) : 1;
                    return { exam, date, shift };
                });

                examDates.sort((a, b) => {
                    const dateComparison = a.date - b.date;
                    return dateComparison !== 0 ? dateComparison : a.shift - b.shift;
                });

                let medianAvgHtml = "", aboveScoreHtml = "", specificRangeHtml = "";
    
                const examLabels = examDates.map(item => item.exam);
                const medianData = examDates.map(({ exam }) => examStats[exam].median);
                const averageData = examDates.map(({ exam }) => examStats[exam].average);
    
                const above140Data = examDates.map(({ exam }) => examStats[exam].above140);
                const above180Data = examDates.map(({ exam }) => examStats[exam].above180);
                const above200Data = examDates.map(({ exam }) => examStats[exam].above200);
                const above230Data = examDates.map(({ exam }) => examStats[exam].above230);
                const above250Data = examDates.map(({ exam }) => examStats[exam].above250);
    
                const range140_160Data = examDates.map(({ exam }) => examStats[exam].range_140_160);
                const range180_200Data = examDates.map(({ exam }) => examStats[exam].range_180_200);
                const range200_230Data = examDates.map(({ exam }) => examStats[exam].range_200_230);
                const range250_aboveData = examDates.map(({ exam }) => examStats[exam].range_250_above);
    
                examDates.forEach(({ exam }) => {
                    const data = examStats[exam];
    
                    medianAvgHtml += `
                        <tr>
                            <td>${exam}</td>
                            <td>${data.totalCount}</td>
                            <td>${data.median}</td>
                            <td>${data.average.toFixed(2)}</td>
                        </tr>`;
    
                    aboveScoreHtml += `
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1;">${exam}</td>
                            <td>${data.totalCount}</td>
                            <td>${data.above140}</td>
                            <td>${data.above180}</td>
                            <td>${data.above200}</td>
                            <td>${data.above230}</td>
                            <td>${data.above250}</td>
                        </tr>`;
    
                    specificRangeHtml += `
                        <tr>
                            <td style="position: sticky; left: -1px; z-index: 1;">${exam}</td>
                            <td>${data.totalCount}</td>
                            <td>${data.range_140_160}</td>
                            <td>${data.range_180_200}</td>
                            <td>${data.range_200_230}</td>
                            <td>${data.range_250_above}</td>
                        </tr>`;
                });
    
                document.getElementById("medianAvgTable").innerHTML = medianAvgHtml;
                document.getElementById("aboveScoreTable").innerHTML = aboveScoreHtml;
                document.getElementById("specificRangeTable").innerHTML = specificRangeHtml;
    
                createChart("medianAvgChart", examLabels, medianData, averageData, "Median Scores", "Average Scores");
                window.aboveScoreChart = createAboveScoreChart("aboveScoreChart", examLabels, above140Data, above180Data, "Above 140", "Above 180");
                window.specificRangeChart = createSpecificRangeChart("specificRangeChart", examLabels, range140_160Data, range180_200Data, "140-160", "180-200");
    
                document.getElementById("aboveScoreSelect1").addEventListener("change", () => updateAboveScoreChart(examLabels, examStats));
                document.getElementById("aboveScoreSelect2").addEventListener("change", () => updateAboveScoreChart(examLabels, examStats));
                document.getElementById("specificRangeSelect1").addEventListener("change", () => updateSpecificRangeChart(examLabels, examStats));
                document.getElementById("specificRangeSelect2").addEventListener("change", () => updateSpecificRangeChart(examLabels, examStats));
    
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }
    
        function toggleView(showId, hideId) {
            document.getElementById(showId).classList.remove("d-none");
            document.getElementById(hideId).classList.add("d-none");
    
            if (showId === "aboveScoreChartContainer") {
                document.getElementById("aboveScoreChartControls").classList.remove("d-none");
            } else {
                document.getElementById("aboveScoreChartControls").classList.add("d-none");
            }
    
            if (showId === "specificRangeChartContainer") {
                document.getElementById("specificRangeChartControls").classList.remove("d-none");
            } else {
                document.getElementById("specificRangeChartControls").classList.add("d-none");
            }
        }
    
        function createChart(canvasId, labels, data1, data2, label1, label2) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label1,
                        data: data1,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: label2,
                        data: data2,
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    
        function createAboveScoreChart(canvasId, labels, data1, data2, label1, label2) {
            const ctx = document.getElementById(canvasId).getContext('2d');
             const newChart =  new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label1,
                        data: data1,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: label2,
                        data: data2,
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                     responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            return newChart;
        }
    
        function createSpecificRangeChart(canvasId, labels, data1, data2, label1, label2) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const newChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label1,
                        data: data1,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: label2,
                        data: data2,
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                     responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            return newChart;
        }
    
        function updateAboveScoreChart(labels, examStats) {
            const select1Value = document.getElementById("aboveScoreSelect1").value;
            const select2Value = document.getElementById("aboveScoreSelect2").value;
    
            const data1 = labels.map(exam => examStats[exam][select1Value]);
            const data2 = labels.map(exam => examStats[exam][select2Value]);
    
            const label1Text = document.getElementById("aboveScoreSelect1").options[document.getElementById("aboveScoreSelect1").selectedIndex].text;
            const label2Text = document.getElementById("aboveScoreSelect2").options[document.getElementById("aboveScoreSelect2").selectedIndex].text;
    
            window.aboveScoreChart.data.datasets[0].data = data1;
            window.aboveScoreChart.data.datasets[0].label = label1Text;
            window.aboveScoreChart.data.datasets[1].data = data2;
            window.aboveScoreChart.data.datasets[1].label = label2Text;
            window.aboveScoreChart.update();
        }
    
        function updateSpecificRangeChart(labels, examStats) {
            const select1Value = document.getElementById("specificRangeSelect1").value;
            const select2Value = document.getElementById("specificRangeSelect2").value;
    
            const data1 = labels.map(exam => examStats[exam][select1Value]);
            const data2 = labels.map(exam => examStats[exam][select2Value]);
    
            const label1Text = document.getElementById("specificRangeSelect1").options[document.getElementById("specificRangeSelect1").selectedIndex].text;
            const label2Text = document.getElementById("specificRangeSelect2").options[document.getElementById("specificRangeSelect2").selectedIndex].text;
    
            window.specificRangeChart.data.datasets[0].data = data1;
            window.specificRangeChart.data.datasets[0].label = label1Text;
            window.specificRangeChart.data.datasets[1].data = data2;
            window.specificRangeChart.data.datasets[1].label = label2Text;
            window.specificRangeChart.update();
        }
    
        document.addEventListener("DOMContentLoaded", fetchData);
    </script>
</body>
</html>